<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="shortcut icon" href="/img/fav.png"/>
<link rel="stylesheet" href="/css/basic.css" type="text/css"/>
<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Cambria">
<title>Main</title>
</head>
<body>
<img src="/img/google.png" alt="Google Logo"/>
<div class="basefont">
<p class="auth">
  Hi {{.User.UserName}}, you are logged in! Your email is {{.User.Email}}.
  <a href="#" id="logout">logout</a>
</p>
</div>
<div id="newPostForm">
  <form action="/newpost" method=post id="post" onsubmit="return false;">
    <label for="text">Text:</label>
    <div>
      <textarea rows=2 maxlength=160 cols=40 name="text" id="text" tabindex=1></textarea>
    </div>
    <input type=submit value="Submit" id="submit" tabindex=2>
  </form>
  <p id="postSent">Post sent.</p>
</div>
<div>
{{$ctx := .}}
{{range .PostList}}
<p class="post">
  <b>{{call $ctx.FormatTime .Time}}</b> {{.Text}}
</p>
{{else}}
<p class="post">
  User haven't posted yet.
</p>
{{end}}
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="//login.persona.org/include.js"></script>
<script src="/js/script.js"></script>
<script>
$(document).ready(function() {
  $('#logout').click(function() {
    navigator.id.logout();
  });
  $('#submit').click(function() {
    var text = $("#text").val();
    if (text == "" || text.length > 180) {
      return false;
    }
    console.log("send data");
    $.ajax({
      type: "POST",
      url: "/newpost",
      data: 'text='+ text,
      success: function() {
        console.log("success callback");
        $('#postSent').show().fadeIn(800, function(){});
      }
    });
    return false;
  });
  $('#postSent').hide();
});

  watchAuth("{{js .User.Email}}");
</script>
</body>
</html>
